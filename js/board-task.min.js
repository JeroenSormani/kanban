!function($){$.fn.board_task=function(task){return this.each(function(){var $task=$(this);$task.timers=[];var $projects_dropdown=$(".project .list-group",$task);$task.on("save",function(t){var a=JSON.parse(JSON.stringify(task));a.action="save_task",a.kanban_nonce=$("#kanban_nonce").val(),$.ajax({method:"POST",url:ajaxurl,data:a}).always(function(t){show_growl_msg(t)}),$(".col-tasks").same_height()}),$task.on("delete",function(t){var a=JSON.parse(JSON.stringify(task));a.action="delete_task",a.kanban_nonce=$("#kanban_nonce").val(),$.ajax({method:"POST",url:ajaxurl,data:a}).done(function(t){delete task_records[task.ID],$task.slideUp("fast",function(){$task.remove(),$(".col-tasks").same_height()})}).always(function(t){show_growl_msg(t)})}),$task.on("add_comment",function(t,a){if("undefined"==typeof a||""==a)return!1;var e={id:task.ID,action:"save_comment",post_type:"task",kanban_nonce:$("#kanban_nonce").val(),comment_content:a};$.ajax({method:"POST",url:ajaxurl,data:e})}),$task.on("status_change",function(t,a){var e=task.terms.kanban_task_status[0]+"";task.terms.kanban_task_status=[a],$task.trigger("save");var r=status_colors[a];$(".task-handle",$task).css({background:r});for(var s in status_records)if(status_records[s].term_id==a){var o=status_records[s];break}$task.trigger("add_comment",['{0} moved the task to "{1}"'.sprintf(current_user.short_name,o.name)]);var n={action:"add_status_change",kanban_nonce:$("#kanban_nonce").val(),task_id:task.ID,status_id_old:e,status_id_new:a};$.ajax({method:"POST",url:ajaxurl,data:n})});var add_work_hour=function(t){var a=JSON.parse(JSON.stringify(task));a.action="add_work_hour",a.kanban_nonce=$("#kanban_nonce").val(),a.operator=t,$.ajax({method:"POST",url:ajaxurl,data:a})};$task.on("click",".editable-input",function(){var t=$(this);t.prop("readonly")&&($(".editable-input").not(t).prop("readonly",!0),t.data("orig",t.val()),t.prop("readonly",!1),setTimeout(function(){t.focus().trigger("click").select()},100))}),$task.on("keyup",".editable-input",function(t){var a=$(this);if(13==t.keyCode&&a.trigger("blur"),27==t.keyCode){var e=a.data("orig");a.val(e).prop("readonly",!0)}}),$task.on("blur",".editable-input",function(t){var a=$(this);a.prop("readonly",!0)}),$task.on("click",".delete-task",function(){return $task.trigger("delete"),$task.trigger("add_comment",["{0} deleted the task".sprintf(current_user.short_name)]),!1}),$("textarea.resize",$task).autoresize({onResize:function(){$(this).addClass("autoresize")}}).trigger("keydown"),$task.on("click",".dropdown-menu-allowed-users .btn",function(){var t=$(this),a=t.val();task.postmeta.kanban_task_user_id_assigned=a,$task.trigger("save"),$task.trigger("populate_user"),$task.trigger("add_comment",["{0} assigned the task to {1}".sprintf(current_user.short_name,$(".task-assigned-to-short_name",$task).text())])}),$task.on("click",".dropdown-menu-estimates .btn",function(){var t=$(this),a=t.val();task.terms.kanban_task_estimate=[a],$task.trigger("save"),$task.trigger("populate_estimate");for(var e in estimates)if(estimates[e].term_taxonomy_id==a){var r=estimates[e];break}$task.trigger("add_comment",["{0} set the task estimate to {1}".sprintf(current_user.short_name,r.name)])}),$task.on("click",".btn-work-hours",function(){return $(".work-hours-operators",$task).toggleClass("active"),!1}),$task.on("click",".work-hours-operators .btn",function(){var $btn=$(this),operator=$btn.val(),current=parseInt(task.postmeta.kanban_task_work_hour_count);current=eval(current+operator),0>current&&(current=0),task.postmeta.kanban_task_work_hour_count=current,$task.trigger("save"),add_work_hour(operator),$task.trigger("populate_work_hour");var comment="+1"==operator?" logged an hour of work":" subtracted an hour of work";return $task.trigger("add_comment",["{0} {1}".sprintf(current_user.short_name,comment)]),!1}),$task.on("populate_project",function(){var t=project_records[task.postmeta.kanban_task_project_id];"undefined"==typeof t&&(t={ID:0,post_title:""}),$task.attr("data-project-id",t.ID),$(".project_title",$task).val(t.post_title).attr("data-id",t.ID)}),$task.trigger("populate_project"),$task.on("keyup",".project_title",function(t){var a=$(this);if(13==t.keyCode){$projects_dropdown.hide();var e={action:"save_project",post_type:"kanban_project",kanban_nonce:$("#kanban_nonce").val(),post_title:a.val()};return void $.ajax({method:"POST",url:ajaxurl,data:e}).done(function(t){"undefined"!=typeof t.data&&"undefined"!=typeof t.data.project&&(project_records[t.data.project.ID]=t.data.project,task.postmeta.kanban_task_project_id=t.data.project.ID,$task.trigger("save").trigger("populate_project"),a.trigger("blur"),$task.trigger("add_comment",['{0} added the task to the project "{1}"'.sprintf(current_user.short_name,t.data.project.post_title)]))}).always(function(t){show_growl_msg(t)})}if(27==t.keyCode)return $projects_dropdown.hide(),void a.trigger("blur");$projects_dropdown.show(),$(".list-group-item",$task).remove();var r=a.val(),s=$.trim(r.toLowerCase());for(var o in project_records){var n=project_records[o],i=n.post_title,_=$.trim(i.toLowerCase());_.search(s)>-1&&$(t_card_projects_dropdown.render(n)).appendTo($projects_dropdown)}0==$(".list-group-item",$task).length&&$projects_dropdown.hide()}),$task.on("focus",".project_title",function(t){var a=$(this);a.trigger("keyup")}),$task.on("click",".project .list-group-item",function(){$projects_dropdown.hide();var t=$(this).attr("data-id");task.postmeta.kanban_task_project_id=t,$task.attr("data-project-id",t),$task.trigger("save");var a=project_records[t];return"undefined"==typeof a?!1:($(".project_title",$task).val(a.post_title),void $task.trigger("add_comment",['{0} added the task to the project "{1}"'.sprintf(current_user.short_name,a.post_title)]))}),$task.on("click",".btn-edit-projects",function(){$projects_dropdown.hide()});var update_progress_bar=function(){var t=0;if("undefined"!=typeof task.terms.kanban_task_estimate[0]&&"undefined"!=typeof task.postmeta.kanban_task_work_hour_count){for(var a in estimates)if(estimates[a].term_taxonomy_id==task.terms.kanban_task_estimate[0]){var e=estimates[a];break}"undefined"!=typeof e&&(t=100*parseInt(task.postmeta.kanban_task_work_hour_count)/parseInt(e.slug))}var r="success";t>133?r="danger":t>100&&(r="warning"),t>100&&(t=100),$(".progress-bar",$task).css({width:t+"%"}).removeClass("progress-bar-success progress-bar-warning progress-bar-danger").addClass("progress-bar-"+r)};$(".task_title",$task).on("keydown",function(t){var a=$(this);return 13==t.keyCode?!1:void 0}).on("blur",function(t){var a=$(this);task.post_title=a.val(),$task.trigger("save"),$task.trigger("add_comment",["{0} updated the task title".sprintf(current_user.short_name)])});for(var i in estimates){var estimate=estimates[i],$estimate=$(t_card_estimates_dropdown.render(estimate));$(".dropdown-menu-estimates",$task).append($estimate)}$task.on("populate_estimate",function(){var t;for(var a in estimates)if(estimates[a].term_taxonomy_id==task.terms.kanban_task_estimate[0]){var t=estimates[a];break}if("undefined"==typeof t)var e="--";else var e=format_hours(t.slug);var r={kanban_task_estimate:e},s=$(t_card_estimate.render(r));$(".btn-estimate",$task).replaceWith(s),update_progress_bar()}).trigger("populate_estimate");for(var i in allowed_users){var user=allowed_users[i],$user=$(t_card_users_dropdown.render(user));$(".dropdown-menu-allowed-users",$task).append($user)}$task.on("populate_user",function(){var t;try{var t=allowed_users[task.postmeta.kanban_task_user_id_assigned];$task.attr("data-assigned-to",task.postmeta.kanban_task_user_id_assigned)}catch(a){}"undefined"==typeof t&&(t={data:{short_name:"-- Assign --",initials:"--"}});var e=$(t_card_user_assigned_to.render(t));$(".btn-assigned-to",$task).replaceWith(e)}).trigger("populate_user"),$task.on("populate_work_hour",function(){task.postmeta.kanban_task_work_hour_count<0&&(task.postmeta.kanban_task_work_hour_count=0);var t;t=format_hours(task.postmeta.kanban_task_work_hour_count);var a={kanban_task_work_hour_count:t},e=$(t_card_work_hours.render(a));$(".btn-work-hours",$task).replaceWith(e),update_progress_bar()}).trigger("populate_work_hour")})}}(jQuery);