var t_col_status=new t($("#t-col-status").html()),t_col_tasks=new t($("#t-col-tasks").html()),t_task=new t($("#t-card").html()),t_card_project=new t($("#t-card-project").html()),t_card_user_assigned_to=new t($("#t-card-user-assigned-to").html()),t_card_work_hours=new t($("#t-card-work-hours").html()),t_card_estimate=new t($("#t-card-estimate").html()),t_allowed_users=new t($("#t-dropdown-allowed-users").html()),t_estimates=new t($("#t-dropdown-estimates").html()),sidebar_w;String.prototype.sprintf=function(){var t=this;for(var s in arguments)t=t.replace("{"+s+"}",arguments[s]);return t};var get_screen_size=function(){return $("#screen-size :visible").attr("data-size")},obj_to_arr=function(t){return $.map(t,function(t,s){return[t]})},format_hours=function(t){var s;if(8>t)s=t+"h";else{s=Math.floor(t/8)+"d";var e=Math.floor(t%8);e>0&&(s+=" "+e+"h")}return s},show_growl_msg=function(t){try{$.bootstrapGrowl(t.data.message,{type:"info"})}catch(s){}},add_task_to_status_col=function(t,s){try{t.status_color=status_colors[t.terms.kanban_task_status[0]]}catch(e){}"undefined"==typeof t.terms.kanban_task_estimate&&(t.terms.kanban_task_estimate=0),"undefined"==typeof t.postmeta.kanban_task_user_id_assigned&&(t.postmeta.kanban_task_user_id_assigned="");var a=$(t_task.render(t));return a.prependTo("#status-{0}-tasks".sprintf(s)).board_task(t),$(".col-tasks").same_height(),a};jQuery(function($){$("#filter-wrapper").board_filter(),$("#search-wrapper").board_search(),$("#btn-group-view-compact").board_view();var t=obj_to_arr(project_records);projects=new Bind({projects:t},{projects:{dom:"#filter-projects-dropdown",transform:function(t){return'<li><a href="#" data-id="'+t.ID+'">'+this.safe(t.post_title)+"</a></li>"}}});var s=obj_to_arr(allowed_users);users=new Bind({users:s},{users:{dom:"#filter-users-dropdown",transform:function(t){return'<li><a href="#" data-id="'+t.data.ID+'">'+this.safe(t.data.long_name_email)+"</a></li>"}}});for(var e in status_records){var a=status_records[e];try{a.color=status_colors[a.term_id]}catch(r){}0==e&&(a.left_open=0,a.left_close="-{0}".sprintf(sidebar_w)),e==status_records.length-1&&(a.left_open="-{0}".sprintf(2*sidebar_w),a.left_close="-{0}".sprintf(sidebar_w));var o=$(t_col_status.render(a));o.appendTo("#row-statuses").board_sidebar_header();var o=$(t_col_tasks.render(a));o.appendTo("#row-tasks"),statuses[a.term_id]=a}for(var e in task_records){var n=task_records[e];if("undefined"==typeof n.terms.kanban_task_status[0]||0==n.terms.kanban_task_status[0]||"undefined"==typeof statuses[n.terms.kanban_task_status[0]]){var i=$("#row-statuses .col").eq(1).attr("data-id");n.terms.kanban_task_status[0]=i}add_task_to_status_col(n,n.terms.kanban_task_status[0])}$(".col-tasks").sortable({connectWith:".col-tasks",handle:".task-handle",forcePlaceholderSize:!0,forceHelperSize:!0,placeholder:"task-placeholder",over:function(t,s){s.placeholder.closest(".col-tasks").addClass("hover")},out:function(t,s){s.placeholder.closest(".col-tasks").removeClass("hover")},stop:function(t,s){$(".col-tasks.hover").removeClass("hover")},receive:function(t,s){var e=s.item.attr("data-id"),a=s.item.closest(".col-tasks"),r=a.attr("data-status-id"),o=a.attr("data-color");tasks[e].task.status_color=o,tasks[e].task.terms.kanban_task_status=[r],s.item.trigger("add_comment",['{0} moved the task to "{1}"'.sprintf(current_user.short_name,$(".status_name",a).text())]),$(".col-tasks").same_height()}}).disableSelection(),$("body").on("keydown",function(t){var s=$("input:focus, textarea:focus");return 37===t.keyCode&&0===s.length&&t.shiftKey&&($(".col-status:last").hasClass("is-open")?$(".col-status:last").trigger("close"):$(".col-status:first").hasClass("is-open")||$(".col-status:first").trigger("open")),39===t.keyCode&&0===s.length&&t.shiftKey&&($(".col-status:first").hasClass("is-open")?$(".col-status:first").trigger("close"):$(".col-status:last").hasClass("is-open")||$(".col-status:last").trigger("open")),9===t.keyCode&&0===s.length?($("#btn-group-view-compact .btn:has(input:not(:checked))").trigger("click"),!1):83===t.keyCode&&0===s.length?($("#board-search").focus(),!1):void 0});var d=[];if(window.location.hash){var l=window.location.hash.substr(1).split("&");for(var e in l){var c=l[e].split("=");"undefined"!=typeof c[1]&&(d[c[0]]=c[1])}}var _=!1;"undefined"!=typeof d.filter_project&&($("#filter-projects-dropdown [data-id="+d.filter_project+"]").click(),_=!0),"undefined"!=typeof d.filter_user&&($("#filter-users-dropdown [data-id="+d.filter_user+"]").click(),_=!0),_&&$("#btn-filter-apply").trigger("click"),$(".col-tasks").on("mouseenter",function(){var t=$(this).attr("data-status-id");$("#status-{0}".sprintf(t)).addClass("hover")}).on("mouseleave",function(){var t=$(this).attr("data-status-id");$("#status-{0}".sprintf(t)).removeClass("hover")}),$(window).load(function(){$(".col-tasks").same_height()}),$(window).resize(function(){$(".col-tasks").same_height()})});