var t_col_status=new t($("#t-col-status").html()),t_col_tasks=new t($("#t-col-tasks").html()),t_card=new t($("#t-card").html()),t_card_project=new t($("#t-card-project").html()),t_card_user_assigned_to=new t($("#t-card-user-assigned-to").html()),t_card_task_hours=new t($("#t-card-task-hours").html()),t_card_estimate=new t($("#t-card-estimate").html()),t_card_users_dropdown=new t($("#t-card-users-dropdown").html()),t_card_estimates_dropdown=new t($("#t-card-estimates-dropdown").html()),t_card_projects_dropdown=new t($("#t-card-projects-dropdown").html()),t_modal_projects_panel=new t($("#t-modal-projects-panel").html()),sidebar_w,$last_clicked,timers=[];String.prototype.sprintf=function(){var t=this;for(var s in arguments)t=t.replace("{"+s+"}",arguments[s]);return t},Object.size=function(t){var s=0,r;for(r in t)t.hasOwnProperty(r)&&s++;return s};var get_screen_size=function(){return $("#screen-size :visible").attr("data-size")},obj_to_arr=function(t){return $.map(t,function(t,s){return[t]})},format_hours=function(t){if(0==t)return"0<small>h</small>";var s=Math.round(60*t),r=Math.floor(s/480),e=s%480,a=Math.floor(e/60),o=e%60,n=Math.floor(o),i="";return r>0&&(i+="{0}<small>d</small>".sprintf(r)),a>0&&(i+="{0}<small>h</small>".sprintf(a)),n>0&&(i+="{0}<small>m</small>".sprintf(n)),""==i&&(i=format_hours(0)),i},show_growl_msg=function(t){try{$.bootstrapGrowl(t.data.message,{type:"info",allow_dismiss:!0})}catch(s){}},add_task_to_status_col=function(t){"undefined"==typeof t.estimate_id&&(t.estimate_id=0),"undefined"==typeof t.user_id_assigned&&(t.user_id_assigned=""),"undefined"!=typeof board.status_records()[t.status_id]&&(t.status_color=board.status_records()[t.status_id].color_hex),"undefined"==typeof t.hour_count&&(t.hour_count=0);var s=$(t_card.render({task:t,settings:board.settings(),current_user_can_write:current_user_has_cap("write")}));return s.prependTo("#status-{0}-tasks".sprintf(t.status_id)).board_task(t),$(".col-tasks").same_height(),s},current_user_has_cap=function(t){return user_has_cap(t,board.current_user())},user_has_cap=function(t,s){try{return s.caps.indexOf(t)<0?!1:!0}catch(r){return!1}},records_by_position=function(t){var s=$.map(t,function(t,s){return[t]});return s.sort(function(t,s){return t.position-s.position}),s};jQuery(function($){$("#filter-wrapper").board_filter(),$("#search-wrapper").board_search(),$("#btn-group-view-compact").board_view(),$("#modal-projects").modal_projects(),$(document).mousedown(function(t){$last_clicked=$(t.target)});var t=records_by_position(board.status_records()),s=0;for(var r in t){var e=t[r];0==s&&(e.left_open=0,e.left_close="-{0}".sprintf(sidebar_w)),s==Object.size(t)-1&&(e.left_open="-{0}".sprintf(2*sidebar_w),e.left_close="-{0}".sprintf(sidebar_w));var a=$(t_col_status.render({status:e,current_user_can_write:current_user_has_cap("write")}));a.appendTo("#row-statuses").board_sidebar_header();var a=$(t_col_tasks.render({status:e,current_user_can_write:current_user_has_cap("write")}));a.appendTo("#row-tasks"),s++}for(var r in board.task_records){var o=board.task_records[r];add_task_to_status_col(o)}current_user_has_cap("write")&&$(".col-tasks").sortable({connectWith:".col-tasks",handle:".task-handle",forcePlaceholderSize:!0,forceHelperSize:!0,placeholder:"task-placeholder",over:function(t,s){s.placeholder.closest(".col-tasks").addClass("hover")},out:function(t,s){s.placeholder.closest(".col-tasks").removeClass("hover")},stop:function(t,s){$(".col-tasks.hover").removeClass("hover")},receive:function(t,s){var r=s.item.attr("data-id"),e=s.item.closest(".col-tasks"),a=e.attr("data-status-id");s.item.trigger("status_change",[a]),$(".col-tasks").same_height()}}).disableSelection(),$("body").on("keydown",function(t){var s=$("input:focus, textarea:focus");return 37===t.keyCode&&0===s.length&&t.shiftKey&&($(".col-status:last").hasClass("is-open")?$(".col-status:last").trigger("close"):$(".col-status:first").hasClass("is-open")||$(".col-status:first").trigger("open")),39===t.keyCode&&0===s.length&&t.shiftKey&&($(".col-status:first").hasClass("is-open")?$(".col-status:first").trigger("close"):$(".col-status:last").hasClass("is-open")||$(".col-status:last").trigger("open")),9===t.keyCode&&0===s.length?($("#btn-group-view-compact .btn:has(input:not(:checked))").trigger("click"),!1):83===t.keyCode&&0===s.length?($("#board-search").focus(),!1):void 0});var n=[];if(location.hash){var i=location.hash.substr(1).split("&");for(var s in i){var c=i[s].split("=");"undefined"!=typeof c[1]&&(n[c[0]]=c[1])}}var d=!1;"undefined"!=typeof n.filter_project&&($("#filter-projects-dropdown [data-id="+n.filter_project+"]").click(),d=!0),"undefined"!=typeof n.filter_user&&($("#filter-users-dropdown [data-id="+n.filter_user+"]").click(),d=!0),d&&$("#btn-filter-apply").trigger("click"),current_user_has_cap("write")&&$(".col-tasks").on("mouseenter",function(){var t=$(this).attr("data-status-id");$("#status-{0}".sprintf(t)).addClass("hover")}).on("mouseleave",function(){var t=$(this).attr("data-status-id");$("#status-{0}".sprintf(t)).removeClass("hover")}),$(window).load(function(){$(".col-tasks").same_height()}),$(window).resize(function(){$(".col-tasks").same_height()})});