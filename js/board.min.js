var t_col_status=new t($("#t-col-status").html()),t_col_tasks=new t($("#t-col-tasks").html()),t_card=new t($("#t-card").html()),t_card_project=new t($("#t-card-project").html()),t_card_user_assigned_to=new t($("#t-card-user-assigned-to").html()),t_card_task_hours=new t($("#t-card-task-hours").html()),t_card_estimate=new t($("#t-card-estimate").html()),t_card_users_dropdown=new t($("#t-card-users-dropdown").html()),t_card_estimates_dropdown=new t($("#t-card-estimates-dropdown").html()),t_card_projects_dropdown=new t($("#t-card-projects-dropdown").html()),t_modal_projects_panel=new t($("#t-modal-projects-panel").html()),sidebar_w,$last_clicked,timers=[];String.prototype.sprintf=function(){var t=this;for(var e in arguments)t=t.replace("{"+e+"}",arguments[e]);return t},Object.size=function(t){var e=0,r;for(r in t)t.hasOwnProperty(r)&&e++;return e};var get_screen_size=function(){return $("#screen-size :visible").attr("data-size")},obj_to_arr=function(t){return $.map(t,function(t,e){return[t]})},format_hours=function(t){if(0==t)return"0<small>h</small>";var e=Math.round(60*t),r=Math.floor(e/480),s=e%480,a=Math.floor(s/60),o=s%60,n=Math.floor(o),i="";return r>0&&(i+="{0}<small>d</small>".sprintf(r)),a>0&&(i+="{0}<small>h</small>".sprintf(a)),n>0&&(i+="{0}<small>m</small>".sprintf(n)),""==i&&(i=format_hours(0)),i},show_growl_msg=function(t){try{$.bootstrapGrowl(t.data.message,{type:"info",allow_dismiss:!0})}catch(e){}},add_task_to_status_col=function(t){"undefined"==typeof t.estimate_id&&(t.estimate_id=0),"undefined"==typeof t.project_id?t.project_id=0:"undefined"==typeof board.project_records[t.project_id]&&(t.project_id=0),"undefined"==typeof t.user_id_assigned?t.user_id_assigned=0:"undefined"==typeof board.allowed_users()[t.user_id_assigned]&&(t.user_id_assigned=0),"undefined"!=typeof board.status_records()[t.status_id]&&(t.status_color=board.status_records()[t.status_id].color_hex),"undefined"==typeof t.hour_count&&(t.hour_count=0);var e=$(t_card.render({task:t,settings:board.settings(),current_user_can_write:current_user_has_cap("write")}));return e.prependTo("#status-{0}-tasks".sprintf(t.status_id)).board_task(t),$(".col-tasks").matchHeight(),e},current_user_has_cap=function(t){return user_has_cap(t,board.current_user())},user_has_cap=function(t,e){try{return e.caps.indexOf(t)<0?!1:!0}catch(r){return!1}},records_by_position=function(t){var e=$.map(t,function(t,e){return[t]});return e.sort(function(t,e){return t.position-e.position}),e};jQuery(function($){$("#filter-wrapper").board_filter(),$("#search-wrapper").board_search(),$("#btn-group-view-compact").board_view(),$("#modal-projects").modal_projects(),$("#btn-empty-status-tasks").on("click",function(){$("#empty-archive-confirmation-label").text("Deleting...");var t=$(this).prop("disabled",!0),e=t.attr("data-status-col-id");timers.delete_task_interval=setInterval(function(){var t=$("#{0} .task:first .delete-task".sprintf(e));0==t.length?(clearInterval(timers.delete_task_interval),$("#btn-empty-status-tasks").prop("disabled",!1),$("#modal-empty-archive").modal("hide")):t.click()},3e3)}),$("#btn-empty-status-tasks-cancel").on("click",function(){clearInterval(timers.delete_task_interval)}),$(document).mousedown(function(t){$last_clicked=$(t.target)});var t=records_by_position(board.status_records()),e=0;for(var r in t){var s=t[r];0==e&&(s.left_open=0,s.left_close="-{0}".sprintf(sidebar_w)),e==Object.size(t)-1&&(s.left_open="-{0}".sprintf(2*sidebar_w),s.left_close="-{0}".sprintf(sidebar_w));var a=$(t_col_status.render({status:s,current_user_can_write:current_user_has_cap("write")}));a.appendTo("#row-statuses").board_sidebar_header();var a=$(t_col_tasks.render({status:s,current_user_can_write:current_user_has_cap("write")}));a.appendTo("#row-tasks"),e++}for(var r in board.task_records){var o=board.task_records[r];add_task_to_status_col(o)}$(document).trigger("/tasks/added/",o),current_user_has_cap("write")&&$(".col-tasks").sortable({connectWith:".col-tasks",handle:".task-handle",forcePlaceholderSize:!0,forceHelperSize:!0,placeholder:"task-placeholder",over:function(t,e){e.placeholder.closest(".col-tasks").addClass("hover")},out:function(t,e){e.placeholder.closest(".col-tasks").removeClass("hover")},stop:function(t,e){$(".col-tasks.hover").removeClass("hover")},receive:function(t,e){var r=e.item.attr("data-id"),s=e.item.closest(".col-tasks"),a=s.attr("data-status-id");e.item.trigger("status_change",[a]),$(".col-tasks").matchHeight()}}),$("body").on("keydown",function(t){var e=$("input:focus, textarea:focus, [contenteditable]:focus");return 37===t.keyCode&&0===e.length&&t.shiftKey&&($(".col-status:last").hasClass("is-open")?$(".col-status:last").trigger("close"):$(".col-status:first").hasClass("is-open")||$(".col-status:first").trigger("open")),39===t.keyCode&&0===e.length&&t.shiftKey&&($(".col-status:first").hasClass("is-open")?$(".col-status:first").trigger("close"):$(".col-status:last").hasClass("is-open")||$(".col-status:last").trigger("open")),9===t.keyCode&&0===e.length?($("#btn-group-view-compact .btn:has(input:not(:checked))").trigger("click"),!1):83===t.keyCode&&0===e.length?($("#board-search").focus(),!1):void 0}),1==board.settings().default_to_compact_view&&$('#btn-group-view-compact .btn:has([name="view-compact"])').trigger("click");var n=[];if(location.hash){var i=location.hash.substr(1).split("&");for(var e in i){var c=i[e].split("=");"undefined"!=typeof c[1]&&(n[c[0]]=c[1])}}var d=!1;for(var l in n)if(0===l.indexOf("filter_")){var r=n[l],_=l.substring("filter_".length);board_filter_store(_,r);var u=$("#filter-{0}".sprintf(_));u.trigger("show.bs.dropdown");var p=$("[data-id={1}]".sprintf(_,r),u);p.trigger("populate_dropdown",[p.text()]),d=!0}d&&$("#btn-filter-apply").trigger("click"),current_user_has_cap("write")&&$(".col-tasks").on("mouseenter",function(){var t=$(this).attr("data-status-id");$("#status-{0}".sprintf(t)).addClass("hover")}).on("mouseleave",function(){var t=$(this).attr("data-status-id");$("#status-{0}".sprintf(t)).removeClass("hover")}),$(window).load(function(){$(".col-tasks").matchHeight()}),$(window).resize(function(){$(".col-tasks").matchHeight()}),""!==alert&&$.bootstrapGrowl(alert,{type:"info",allow_dismiss:!0})});